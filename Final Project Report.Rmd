---
title: "Final Project Report"
author: "Cam Saeger, Bryce Barnett, Riley Bechel"
date: "2025-12-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Descriptive Statistics On Wahlberg Connections


```{r graph, echo=FALSE, message=FALSE, warning=FALSE, results = 'hide'}
library(igraph)
library(rvest)
library(tidyverse)
library(TMDb)
library(dplyr)
library(purrr)
library(tibble)
library(tidyr)
library(ggplot2)


movies <- read.csv("movie")  
actor <- read.csv("actor1") %>%
  rename(id = movie_id)
movies <- movies %>%  
  distinct(id, .keep_all = TRUE)
actor_movies <- actor %>% 
  left_join(movies, by = "id", relationship = "many-to-many")
actor_graph <- graph_from_data_frame(actor_movies[, c("actor_name", "id")], directed = FALSE)

connect_to_mark <- function(actor) {
  p <- shortest_paths(actor_graph, actor, "Mark Wahlberg")$vpath[[1]]              
  if (length(p) == 0) return("No connection found.")    

  nodes <- names(p)

  path <- sapply(nodes, function(x)
    if (x %in% actor_movies$id) actor_movies$title[actor_movies$id == x][1] else x
  )

  movie_count <- sum(path %in% actor_movies$title)

  list(
    path = unname(path),
    movies = movie_count
  )
}

wahlberg_distances <- distances(
  actor_graph,
  v = V(actor_graph),
  to = "Mark Wahlberg"
)

wahlberg_df <- data.frame(
  actor = rownames(wahlberg_distances),
  wahlberg_number = as.numeric(wahlberg_distances[,1])
)

wahlberg_df_connected <- wahlberg_df %>%
  filter(is.finite(wahlberg_number))

summary(wahlberg_df_connected$wahlberg_number)

ggplot(wahlberg_df_connected, aes(x = wahlberg_number)) +
  geom_bar(fill = "blue") +
  labs(
    title = "Distribution of Wahlberg Numbers",
    x = "Wahlberg Number (distance from Mark Wahlberg)",
    y = "Number of actors"
  ) + theme_minimal()
```
 
 
 - Statistic Results:
Minimum: 0  1st Quartile: 5   Median: 6   Mean:6.206  3rd Quartile: 8   Maximum: 24

  -The minimum here being 0 makes sense because that is connecting Mark Wahlberg to himself. Our data has a mean distance from Mark Wahlberg of 6.206 movies, with a median of 6 movies. The actor with the furthest distance is 24 movies. (These statistics do not include any actors that did not have a connection to Mark Wahlberg)

 - Graphic Results:
 Our data, based on our histogram, turned out to be slightly skewed to the right, with the most of the data of actors centered around about 6 movies from Mark Wahlberg. One thing we found interesting was how there is a significant dip before and after the median of the data at 6 movies from Mark, which then jumps back up afterwards.

# Undirected Subset Connectedness Graph


```{r graph 2,echo=FALSE, message=FALSE, warning=FALSE, results = 'hide'}
actor_edges <- actor_movies %>%
  select(id, actor_name) %>%
  distinct() %>%
  inner_join(., ., by = "id") %>%
  filter(actor_name.x != actor_name.y) %>%
  select(from = actor_name.x, to = actor_name.y)
actor_graph_all <- graph_from_data_frame(actor_edges, directed = FALSE)
selected_actors <- c(
  "Mark Wahlberg",
  "Mila Kunis",
  "Michael B. Jordan",
  "Jason Momoa",
  "Scarlett Johansson",
  "Chris Evans",
  "Leonardo DiCaprio",
  "Kevin Hart",
  "Dwayne Johnson",
  "Kevin Bacon"
)

g10 <- induced_subgraph(
  actor_graph_all,
  V(actor_graph_all)$name %in% selected_actors
)

plot(
  g10,
  layout = layout_with_fr(g10) * 3,
  vertex.size = 25,
  vertex.label.cex = 0.8,
  edge.width = 3
)

connect_to_mark_2 <- function(actor, graph, actor_movies) {

  p <- shortest_paths(
    graph,
    from = actor,
    to   = "Mark Wahlberg"
  )$vpath[[1]]

  if (length(p) == 0) {
    return(list(path = "No connection found.", movies = NA))
  }

  nodes <- names(p)

  path <- sapply(nodes, function(x) {
    if (x %in% actor_movies$id) {
      actor_movies$title[actor_movies$id == x][1]
    } else {
      x
    }
  })

  movie_count <- sum(path %in% actor_movies$title)
  
  list(
    path   = unname(path),
    movies = movie_count
  )
}

make_restricted_graph <- function(full_graph, allowed_movie_ids) {

  
  keep_names <- c(
    V(full_graph)$name[!(V(full_graph)$name %in% actor_movies$id)],
    allowed_movie_ids
  )

 
  induced_subgraph(
    full_graph,
    vids = V(full_graph)[name %in% keep_names]
  )
}

cutoff <- quantile(actor_movies$popularity, 0.90, na.rm = TRUE)


allowed_movies <- actor_movies$id[actor_movies$popularity >= cutoff]


popular_graph <- make_restricted_graph(actor_graph, allowed_movies)

```

# Wahlberg Function Results

```{r function, echo=FALSE, message=FALSE, warning=FALSE}
connect_to_mark("Jason Momoa")
connect_to_mark("Kevin Hart")
connect_to_mark("Jennifer Aniston")
connect_to_mark("Kevin Bacon")
```

# Wahlberg Modified Function Results

```{r function 2, echo=FALSE, message=FALSE, warning=FALSE}
connect_to_mark_2("Jason Momoa", popular_graph, actor_movies)
connect_to_mark_2("Kevin Hart", popular_graph, actor_movies)
connect_to_mark_2("Jennifer Aniston", popular_graph, actor_movies)
```



1. We did not take data from IMDb, instead we downloaded a package called TMDb, which has an API Key to access it. We then pulled all of our data from this package, which was action movies from 2010 to 2020, giving us a little over 11,000 movies, with just under 170,000 actors. In order to work with this package and pull all of the data and join it together into one file, we had to use help from ChatGPT to do so, as this package was somewhat confusing to use. We then wrote our data frames into csv files for easy use, and then joined them into one large dataset. 

2. The additional information we ended up pulling from this package was movie popularity, which we then took into account for with our modified function in question 5.

3. In building our connectedness graph, we had to first create a data set of edges of the connections between actors and movies. This was quite difficult to figure out ourselves, so we had to get some more help from ChatGPT as well. Then, we wrote connectedness actor graph in and utilized it to create our function. We had to work on putting together the connection_to_mark function. Overall, there were a couple different things we had to work around. One specific thing we had to work around was replacing the movie id with movie titles. This was fixed by putting nodes <- names(p) in the code chunk with the function so it output the movies in the path it took. Also, creating the path and the sum of the path was difficult. We worked around the addition of the paths part by asking ChatGPT how to add the paths up to output the Bacon/Wahlberg number. We then chose a subset of actors to visualize an undirected connectedness graph. We saw some of them directly connected to Mark, other connected to Mark through someone else, one group connected to just each other, and a few not directly connected to any one in the subset.

4. We ran Descriptive Statistics on our collection of data, which required us to create an additional data frame that removed any actors not connected to Mark in any way. This was necessary because it would drastically change our results of our statistics. We then found the longest distance from Mark Wahlberg to any actor was a whopping 24 movies, which was significantly higher than the majority of our data. We chose to visualize this through a histogram, we chose this because it is a graph that is easy to read and explain to an audience. 

5. For modifying our function, we did not need to modify it in order to tell us our path from one actor to Mark Wahlberg. We chose to incorporate this into our function right from the start. So, for example, if starting with Jason Momoa, our function then went to the movie Bullet To The Head, which had actor Dane Rhodes, which then went to the movie Contraband which lead us to Mark Wahlberg. So, if starting with Jason Momoa, it took only two movies to connect back to Mark Wahlberg. Then relating back to question 2, we chose our topic to restrict the function to be only the top 10% popular action movies from 2010 to 2020. In doing this, it caused the amount of steps to connect back to Mark Wahlberg to increase. This was expected as any restriction placed would increase the number of steps because it was already at its shortest path to Mark Wahlberg.


