---
title: "Super Awesome Project Template"
output: word_document
date: "2023-03-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section One

```{r student1 - Cam, warning=FALSE}
library(igraph)
library(rvest)
library(tidyverse)
```


```{r}

### Creating Movies Database

library(TMDb)
library(dplyr)
library(tidyverse)
api_key <- "17dccb4de2aa1a7bf742763a8dc633be"


movies <- discover_movie(
  api_key     = api_key,
  with_genres = 28,             
  primary_release_year = "2000"
)

movies_list <- movies$results

movies_df <- movies_list %>%
  select(id, title, release_date)

years <- as.character(2000:2024)

get_year_movies <- function(year_str) {

  first <- discover_movie(
    api_key = api_key,
    with_genres = 28,
    primary_release_year = year_str,
    page = 1
  )

  total_pages <- min(first$total_pages, 500)

  map_df(1:total_pages, ~ {
    Sys.sleep(0.25) 
    discover_movie(
      api_key = api_key,
      with_genres = 28,
      primary_release_year = year_str,
      page = .x
    )$results
  })
}

movies_all <- map_df(years, get_year_movies)

movies_df <- movies_all %>%
  select(id, title, release_date) 
```


```{r}

###                 

movies_df1 <- movies_all %>%
  select(id, title, popularity, release_date) 

movie_ids <- movies_df$id
```


```{r}
library(purrr)
library(dplyr)
library(tibble)


safe_movie_credits <- purrr::possibly(
  ~ movie_credits(api_key, .x),
  otherwise = NULL
)

credits_list <- map(movies_df$id, safe_movie_credits)



top_actor <- map_chr(
  credits_list,
  ~ pluck(.x, "cast", 1, "name", .default = NA_character_)
)

director <- map_chr(
  credits_list,
  ~ {
    if (is.null(.x)) return(NA_character_)
    crew <- pluck(.x, "crew", .default = list())
    dir_row <- keep(crew, ~ pluck(.x, "job", .default = "") == "Director")
    if (length(dir_row) == 0) NA_character_
    else pluck(dir_row[[1]], "name", .default = NA_character_)
  }
)


movies_enriched <- movies_df %>%
  mutate(
    top_actor = top_actor,
    director = director
  )

movies_enriched


```



## Section Two
```{r}
library(TMDb)
library(dplyr)
api_key <- "17dccb4de2aa1a7bf742763a8dc633be"


movies <- discover_movie(
  api_key     = api_key,
  with_genres = 28,                 # 28 = Action
  primary_release_year = "2000"
)
library(TMDb)


searchOBAA <- search_movie(api_key = api_key, query = "One Battle After Another")
movie_idOBAA <- searchOBAA$results$id

# Get credits (cast + crew)
creditsOBAA <- movie_credits(api_key = api_key, id = movie_idOBAA)

# Inspect cast
castOBAA <- creditsOBAA$cast
castOBAA[, c("name", "character")]

movies_list <- movies$results

movies_df <- movies_list %>%
  select(id, title, release_date)

years <- as.character(2000:2024)

get_year_movies <- function(year_str) {

  first <- discover_movie(
    api_key = api_key,
    with_genres = 28,
    primary_release_year = year_str,
    page = 1
  )

  total_pages <- min(first$total_pages, 500)

  map_df(1:total_pages, ~ {
    Sys.sleep(0.25)
    discover_movie(
      api_key = api_key,
      with_genres = 28,
      primary_release_year = year_str,
      page = .x
    )$results
  })
}

movies_all <- map_df(years, get_year_movies)

movies_df <- movies_all %>%
  select(id, title, release_date) 
```


## Section Three
```{r student3 - Riley}


```
